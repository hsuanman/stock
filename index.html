<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <link rel="icon" href="/stock/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/stock/favicon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <input type="button" onclick="window.open('/stock/payback.html')" value="回本計算" style="width:100px" ></input>
    <title>股票平均價格計算機</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        .container {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .input-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 4px;
            border: 1px solid #ddd;
            gap: 8px;
        }
        .input-group {
            flex: 1;
            min-width: 120px;
        }
        label {
            display: block;
            margin-bottom: 3px;
            font-weight: bold;
            color: #555;
            font-size: 0.9rem;
        }
        input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
            font-size: 1rem;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 1rem;
            white-space: nowrap;
        }
        #add-row {
            background-color: #2196F3;
            width: 100%;
            margin: 10px 0;
        }
        .subtotal {
            margin-left: auto;
            font-weight: bold;
            color: #E91E63;
            font-size: 0.9rem;
            min-width: 100px;
            text-align: right;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f5e9;
            border-radius: 4px;
            border-left: 4px solid #4CAF50;
        }
        .avg-price {
            font-size: 1.3rem;
            color: #2E7D32;
            font-weight: bold;
        }
        .remove-row {
            background-color: #f44336;
            padding: 8px 12px;
            margin-left: 5px;
        }
        
        /* 手機版專用樣式 */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 10px;
            }
            .input-row {
                padding: 8px;
            }
            input {
                padding: 8px;
            }
            button {
                padding: 8px 12px;
            }
            #add-row {
                margin: 8px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>股票平均價格計算機</h1>
        
        <div id="inputs">
            <!-- 輸入欄位會動態新增在這裡 -->
        </div>
        
        <button id="add-row">+ 新增一筆</button>
        
        <div id="result">
            <p>平均成本價: <span class="avg-price" id="avg-price">0.00</span> 元/股</p>
            <p>總股數: <span id="total-shares">0</span> 股</p>
            <p>總投資金額: <span id="total-cost">0</span> 元</p>
        </div>
    </div>

    <script>
        // 初始化第一行
        document.addEventListener('DOMContentLoaded', function() {
            addRow();
            
            // 綁定新增按鈕事件
            document.getElementById('add-row').addEventListener('click', function() {
                if (document.querySelectorAll('.input-row').length < 5) {
                    addRow();
                } else {
                    alert('最多只能輸入5筆交易記錄');
                }
            });
        });

        // 新增一行輸入欄位
        function addRow() {
            const inputsContainer = document.getElementById('inputs');
            const rowCount = document.querySelectorAll('.input-row').length + 1;
            
            const row = document.createElement('div');
            row.className = 'input-row';
            row.innerHTML = `
                <div class="input-group">
                    <label>買入價格 ${rowCount}</label>
                    <input type="number" class="price" placeholder="價格" step="0.01" min="0">
                </div>
                <div class="input-group">
                    <label>數量</label>
                    <input type="number" class="qty" placeholder="股數" min="0">
                </div>
                <div class="subtotal">小計: <span class="subtotal-value">0</span> 元</div>
                <button class="remove-row">×</button>
            `;
            
            inputsContainer.appendChild(row);
            
            // 綁定輸入事件
            const priceInput = row.querySelector('.price');
            const qtyInput = row.querySelector('.qty');
            
            priceInput.addEventListener('input', calculateAll);
            qtyInput.addEventListener('input', calculateAll);
            
            // 綁定刪除按鈕
            row.querySelector('.remove-row').addEventListener('click', function() {
                row.remove();
                updateRowNumbers();
                calculateAll();
            });
            
            // 自動聚焦到新欄位的價格輸入框
            priceInput.focus();
        }

        // 更新行號
        function updateRowNumbers() {
            const rows = document.querySelectorAll('.input-row');
            rows.forEach((row, index) => {
                const label = row.querySelector('label');
                if (label) {
                    label.textContent = `買入價格 ${index + 1}`;
                }
            });
        }

        // 計算所有數據
        function calculateAll() {
            const rows = document.querySelectorAll('.input-row');
            let totalCost = 0;
            let totalShares = 0;
            
            rows.forEach(row => {
                const price = parseFloat(row.querySelector('.price').value) || 0;
                const qty = parseFloat(row.querySelector('.qty').value) || 0;
                const subtotal = Math.round(price * qty); // 四捨五入到整數
                
                // 更新小計
                row.querySelector('.subtotal-value').textContent = subtotal;
                
                totalCost += subtotal;
                totalShares += qty;
            });
            
            // 計算平均價格（保留小數點後兩位）
            const avgPrice = totalShares > 0 ? (totalCost / totalShares).toFixed(2) : "0.00";
            
            // 更新結果
            document.getElementById('avg-price').textContent = avgPrice;
            document.getElementById('total-shares').textContent = totalShares;
            document.getElementById('total-cost').textContent = totalCost;
        }
    </script>
</body>
</html>
    

